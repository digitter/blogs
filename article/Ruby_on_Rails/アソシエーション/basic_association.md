---
marp: true
paginate: true
footer: "by kazuki tanida"
---

<!-- prerender: true -->

<style>
  section {
    font-size: 20px
  }
</style>

# Rails ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šæ–¹æ³•ã¨ãƒ¡ãƒªãƒƒãƒˆ
## 1:å¤šã®é–¢ä¿‚ã‚¤ãƒ¡ãƒ¼ã‚¸å›³

![ã‚¤ãƒ¡ãƒ¼ã‚¸å›³](userbook.png)

---

## ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã¯å¤§ããæ‰ãˆã¦2ã¤ã ã‘
1. ãƒ¢ãƒ‡ãƒ«ã«é–¢ä¿‚æ€§ã‚’å®šç¾©
>Userãƒ¢ãƒ‡ãƒ«ã«has_many :books ã®è¨­å®šã‚’å®šç¾©ã™ã‚‹
>Bookãƒ¢ãƒ‡ãƒ«ã«belongs_to :user ã®è¨­å®šã‚’å®šç¾©ã™ã‚‹

2. idãƒ¬ãƒ™ãƒ«ã§ç´ä»˜ã‘
>ã€ŒNãŒã€`ç›¸æ‰‹ã®id`ã‚’ `ç›¸æ‰‹ã®ãƒ¢ãƒ‡ãƒ«å_idã«` ä¿æŒã—ã¦ã„ã‚‹
*ä¸»ã‚­ãƒ¼(id)ã¨å¤–éƒ¨ã‚­ãƒ¼(user_id)ã®ç´ä»˜ã‘


---

## è¨­å®šæ–¹æ³•ã¯åˆ†ã‹ã£ãŸã‘ã©...ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã§å¬‰ã—ã„ã“ã¨ã¨ã¯ï¼Ÿ

ãã®ï¼‘: `userã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹.books` ã§
  >ç´ã¥ã„ãŸbookã‚’å…¨ã¦å–å¾—ã§ãã‚‹

ãã®ï¼’: `bookã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹.user` ã§
  >ç´ã¥ã„ãŸuserã‚’ä¸€äººå–å¾—ã§ãã‚‹

ç´ã¥ãã‚‚ã®ã‚’å–å¾—ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚

---

# å®Ÿéš›ã«æ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸï¼ğŸ˜²

---

## ã“ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹ã¨ã—ã¾ã™

usersãƒ†ãƒ¼ãƒ–ãƒ«
|id|name|introduction|
|---|---|---|
|1|ãƒ¡ãƒ³ã‚¿ãƒ¼å¤ªéƒ|RubyãŒå¾—æ„ã§ã™|
|2|ãƒ¡ãƒ³ã‚¿ãƒ¼äºŒéƒ|HTML/CSSãŒå¾—æ„ã§ã™|
|3|ã­ãšã“|é¬¼æ»…ã®ä¸»äººå…¬ã®å¦¹ã§ã™ã€‚ã€‚ã€‚|

booksãƒ†ãƒ¼ãƒ–ãƒ«
|id|title|body|user_id|
|---|---|---|---|
|1|Ruby on Railsãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³|ä»•çµ„ã¿ãŒã‚ˆãåˆ†ã‹ã£ãŸï¼|1|
|2|HTML/CSSãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³|ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¢—ãˆãŸï¼|2|
|3|é¬¼æ»…ã®åˆƒ|é¢ç™½ã‹ã£ãŸï¼|3|
|4|æ˜Ÿã®ç‹å­æ§˜|å¤§åˆ‡ãªã‚‚ã®ã¨ã¯ä½•ã‹è€ƒãˆã•ã›ã‚‰ã‚ŒãŸã€‚ã€‚ã€‚|1|

---

## rails cã§ã¯ã“ã®ã‚ˆã†ã«å–å¾—ã§ãã¾ã™

```
> rails c

> User.all # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å…¨ã¦ã®Userã‚’å–å¾—

[#<user id: 1, name: 'ãƒ¡ãƒ³ã‚¿ãƒ¼å¤ªéƒ', introduction: 'RubyãŒå¾—æ„ã§ã™', ... >
#<user id: 2, name: 'ãƒ¡ãƒ³ã‚¿ãƒ¼äºŒéƒ', introduction: 'HTML/CSSãŒå¾—æ„ã§ã™', ... >
#<user id: 3, name: 'ã­ãšã“', introduction: 'é¬¼æ»…ã®ä¸»äººå…¬ã®å¦¹ã§ã™ã€‚ã€‚ã€‚', ... >]
```

```
> rails c

> Book.all # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å…¨ã¦ã®Bookã‚’å–å¾—

[#<book id: 1, title: 'Ruby on Railsãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³', body: 'ä»•çµ„ã¿ãŒã‚ˆãåˆ†ã‹ã£ãŸï¼', user_id: 1, ... >,
#<book id: 2, title: 'HTML/CSSãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³', body: 'ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¢—ãˆãŸï¼', user_id: 2, ... >,
#<book id: 3, title: 'é¬¼æ»…ã®åˆƒ', body: 'é¢ç™½ã‹ã£ãŸï¼', user_id: 3, ... >,
#<book id: 4, title: 'æ˜Ÿã®ç‹å­æ§˜', body: 'å¤§åˆ‡ãªã‚‚ã®ã¨ã¯ä½•ã‹è€ƒãˆã•ã›ã‚‰ã‚ŒãŸã€‚ã€‚ã€‚', user_id: 1, ... >]
```

---

## å®Ÿéš›ã«å®Ÿé¨“ã—ã¦ã¿ã‚‹
`rails console` ã§å®Ÿé¨“ã—ã¦ã¿ã‚‹ã¨...


```
â¯ rails c

Running via Spring preloader in process 16083
Loading development environment (Rails 5.2.4.3)

[1] pry(main)> user_instance = User.find(1)
  User Load (0.5ms)  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?  [["id", 1], ["LIMIT", 1]]
=> #<User id: 1, name: 'ãƒ¡ãƒ³ã‚¿ãƒ¼å¤ªéƒ', introduction: 'RubyãŒå¾—æ„ã§ã™', ... >

[2] pry(main)> user_instance.books
  Book Load (0.7ms)  SELECT "books".* FROM "books" WHERE "books"."user_id" = ?  [["user_id", 1]]
=> [#<Book id: 1, title: 'Ruby on Railsãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³', body: 'ä»•çµ„ã¿ãŒã‚ˆãåˆ†ã‹ã£ãŸï¼', user_id: 1, ... >,
  #<Book id: 4, title: 'æ˜Ÿã®ç‹å­æ§˜': 'å¤§åˆ‡ãªã‚‚ã®ã¨ã¯ä½•ã‹è€ƒãˆã•ã›ã‚‰ã‚ŒãŸã€‚ã€‚ã€‚', user_id: 1, ...> ]
```

`idãŒ1ã®user`ã‹ã‚‰`user_idãŒ1ã®bookã‚’`2ã¤å‰²ã‚Šå‡ºã›ã¾ã—ãŸã€‚

---

# userã‹ã‚‰bookã‚’å–å¾—ã§ãã€bookã‹ã‚‰userã‚’å–å¾—ã§ãã‚‹
## ã“ã‚Œã‚’ç°¡å˜ã«ã§ãã‚‹ã®ãŒã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼ŸğŸ˜ƒ

---

## å‚è€ƒ

- Active Record ã®åŸºç¤ - ã‚¹ã‚­ãƒ¼ãƒã®ãƒ«ãƒ¼ãƒ«
https://railsguides.jp/active_record_basics.html#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB

- Active Record ã®é–¢é€£ä»˜ã‘
https://railsguides.jp/association_basics.html
